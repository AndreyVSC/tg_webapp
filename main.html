<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Telegramm WebApp</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        data = [[]]
        let tg = window.Telegram.WebApp;
        function getproducts() {
            let kek = document.querySelectorAll(':disabled')
            console.log(kek)
            if(typeof kek[0] != "undefined") {
                data = data +[,]+[kek[0].value + "-" + kek[0].innerHTML] + "_"
            }
            if(typeof kek[1] != "undefined") {
                data = data+[,] +[kek[1].value + "-" + kek[1].innerHTML,]+ "_"
            }
            if(typeof kek[2] != "undefined") {
                data = data +[,]+ [kek[2].value + "-" + kek[2].innerHTML,]+ "_"
            }
            if(typeof kek[3] != "undefined") {
                data = data+[,]+[kek[3].value + "-" + kek[3].innerHTML,]+ "_"
            }
            if(typeof kek[4] != "undefined") {
                data = data+[,]+[kek[4].value + "-" + kek[4].innerHTML,]+ "_"
            }
            if(typeof kek[5] != "undefined") {
                data = data+[,]+[kek[5].value + "-" + kek[5].innerHTML,]+ "_"
            }
            tg.sendData(data);
        }
        function setproductcost(card_id, operation) {
            card_id = card_id.toString();
            
            let card = document.getElementById(card_id);
            
            old_value = card.innerHTML;
            new_value = Number(old_value) + operation;
            console.log(new_value);
            card.innerHTML = new_value
            product_name = card_id.split("_")[0]
            card.setAttribute("value", product_name)
            if (new_value <= 0) {
                new_card_id = card_id.split("_")[0]+"_minus"
                console.log(new_card_id);
                let card = document.getElementById(new_card_id)
                card.setAttribute("disabled",true)

            }
            else {
                new_card_id = card_id.split("_")[0]+"_minus"
                console.log(new_card_id);
                let card = document.getElementById(new_card_id)
                card.removeAttribute("disabled")

             
            }
        }
        function minus(minus_id) {
            setproductcost(minus_id, -1);
        }
        function plus(minus_id) {
            setproductcost(minus_id, +1);
        }
        function buy(product, cost, btn_id, card_id) {
            let btn = document.getElementById(btn_id);
            let card = document.getElementById(card_id);
            card.removeChild(btn);


            let minus = document.createElement("button");
            minus.innerHTML = "-";
            minus_id = card_id.split("_")[0].toString() + "_minus"
            value_generated_id = card_id.split("_")[0].toString() + "_value";
            minus.setAttribute("onclick", 'minus("'+value_generated_id+'")');
            minus.setAttribute("id", minus_id)
            minus.setAttribute("class", "interface")
            card.appendChild(minus);


            let value = document.createElement("button");
            value.innerHTML = "1";
            product_name = card_id.split("_")[0]
            value.setAttribute("value", product_name)
            value.id = value_generated_id;
            value.setAttribute("disabled","True");
            value.setAttribute("class", "interface")
            card.appendChild(value);



            let plus = document.createElement("button");
            plus.innerHTML = "+";
            plus_id = card_id.split("_")[0].toString() + "_plus"
            value_generated_id = card_id.split("_")[0].toString() + "_value";
            plus.setAttribute("onclick", 'plus("'+value_generated_id+'")');
            plus.setAttribute("id", plus_id)
            plus.setAttribute("class", "interface")
            card.appendChild(plus);

            tg.MainButton.text = "Перейти к оплате"
            tg.MainButton.color = " #5ebd00"

            
            tg.MainButton.show();
            
        }
        tg.MainButton.enable();
        if (tg.MainButton.isVisible == true) {
            tg.MainButton.hide();
        }
        Telegram.WebApp.onEvent('mainButtonClicked', function () {
                if (data != [[]]) {
                    getproducts()
                }
            })
        


    </script>
        <div id="products">
            <div class="inner">
                <div class="Пельмени" id="pelmeni_card">
                    <img class="img" src="img/Пельмени.png">
                    <p></p>
                    <p2>Пельмени</p2>
                    <p></p>
                    <button class="btn" id="pelmeni_button" onclick="buy('пельмени','190 руб', id, 'pelmeni_card')">купить</button>
                </div>
                <div class="card" id="plov_card">
                    <img class="img" src="img/Плов.png">
                    <p></p>
                    <p2>Плов</p2>
                    <p></p>
                    <button class="btn" id="plov_button" onclick="buy('плов','490 руб', id, 'plov_card')">купить</button>
                </div>

                <div class="card" id="shaslik_card">
                    <img class="img" src="img/Шашлыки.png">
                    <p></p>
                    <p2>Шашлык</p2>
                    <p></p>
                    <button class="btn" id="shaslik_button" onclick="buy('шашлык','1090 руб', id, 'shaslik_card')">купить</button>
                    
                </div>
                <div class="card" id="манты_card">
                    <img class="img" src="img/Манты.png">
                    <p></p>
                    <p2>манты</p2>
                    <p></p>
                    <button class="btn" id="манты_button" onclick="buy('манты','40 руб', id, 'манты_card')">купить</button>
                </div>
                <div class="card" id="dolma_card">
                    <img class="img" src="img/Долма.png">
                    <p></p>
                    <p2>Долма</p2>
                    <p></p>
                    <button class="btn" id="dolma_button" onclick="buy('долма','90 руб', id, 'dolma_card')">купить</button>
                </div>
                <div class="card" id="kazan kabob_card">
                    <img class="img" src="img/Казан кабоб.png">
                    <p></p>
                    <p2>Казан кабоб</p2>
                    <p></p>
                    <button class="btn" id="kazan kabob_button" onclick="buy('Казан кабоб','90 руб', id, 'kazan kabob_card')">купить</button>
                </div>
                <div class="card" id="Kuza shurpa_card">
                    <img class="img" src="img/Куза шурпа.png">
                    <p></p>
                    <p2>Куза шурпа</p2>
                    <p></p>
                    <button class="btn" id="kuza shurpa_button" onclick="buy('Куза шурпа','90 руб', id, 'kuza shurpa_card')">купить</button>
                </div>
                <div class="card" id="lagman_card">
                    <img class="img" src="img/Лагман.png">
                    <p></p>
                    <p2>Лагман</p2>
                    <p></p>
                    <button class="btn" id="lagman_button" onclick="buy('Лагман','90 руб', id, 'lagman_card')">купить</button>
                </div>
                <div class="card" id="gizhduvanskiy shaslik_card">
                    <img class="img" src="img/Гиждуванский шашлык.png">
                    <p></p>
                    <p2>Гиждуванский шашлык</p2>
                    <p></p>
                    <button class="btn" id="gizhduvanskiy shaslik_button" onclick="buy('Гиждуванский шашлык','90 руб', id, 'gizhduvanskiy shaslik_card')">купить</button>
                </div>

                </div>
            </div>
        </div>
    

</body>
</html>
